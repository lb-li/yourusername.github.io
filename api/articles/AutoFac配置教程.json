{"title":"AutoFac配置教程","uid":"587b43135c6f3485b613ca8a7483ff63","slug":"AutoFac配置教程","date":"2024-07-05T00:52:10.000Z","updated":"2024-07-19T08:00:52.733Z","comments":true,"path":"api/articles/AutoFac配置教程.json","keywords":null,"cover":null,"content":"<h2 id=\"1-安装-AutoFac\"><a href=\"#1-安装-AutoFac\" class=\"headerlink\" title=\"1. 安装 AutoFac\"></a>1. 安装 AutoFac</h2><p>在项目中安装 <code>Autofac.Extensions.DependencyInjection</code> 包：</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">dotnet</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">add</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">package</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Autofac.Extensions.DependencyInjection</span></span></code></pre></div><h2 id=\"2-配置类-CustomAutofacModule\"><a href=\"#2-配置类-CustomAutofacModule\" class=\"headerlink\" title=\"2. 配置类 CustomAutofacModule\"></a>2. 配置类 CustomAutofacModule</h2><p>将配置类 <code>CustomAutofacModule</code> 放入拓展文件夹，并修改程序包名</p>\n<div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Autofac</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Reflection</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">namespace</span><span style=\"color: #BABED8\"> NET8Demo</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Api</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">CustomAutofacModule</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Autofac</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #FFCB6B\">Module</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;</span><span style=\"color: #F07178; font-style: italic\">summary</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// AutoFac注册类</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;/</span><span style=\"color: #F07178; font-style: italic\">summary</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;</span><span style=\"color: #F07178; font-style: italic\">param</span><span style=\"color: #89DDFF; font-style: italic\"> </span><span style=\"color: #C792EA; font-style: italic\">name</span><span style=\"color: #89DDFF; font-style: italic\">=</span><span style=\"color: #89DDFF; font-style: italic\">&quot;</span><span style=\"color: #C3E88D; font-style: italic\">builder</span><span style=\"color: #89DDFF; font-style: italic\">&quot;</span><span style=\"color: #89DDFF; font-style: italic\">&gt;&lt;/</span><span style=\"color: #F07178; font-style: italic\">param</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">protected</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">override</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Load</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ContainerBuilder</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">builder</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">List</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">Type</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">types</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">List</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">Type</span><span style=\"color: #89DDFF\">&gt;();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">var</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">svrNames</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">NET8Demo.Bll</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">NET8Demo.Dal</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;;</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\">//程序及名称</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">foreach</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">item</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> svrNames</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">// 加载接口服务实现层。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">Assembly</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">SvrAss</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> Assembly</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Load</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">// 反射扫描这个程序集中所有的类，得到这个程序集中所有类的集合。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                types</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddRange</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">SvrAss</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">GetTypes</span><span style=\"color: #89DDFF\">());</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">// 告诉AutoFac容器，创建stypes这个集合中所有类的对象实例  在一次Http请求上下文中,共享一个组件实例</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RegisterTypes</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">types</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">ToArray</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AsImplementedInterfaces</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">InstancePerLifetimeScope</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">PropertiesAutowired</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//指明创建的stypes这个集合中所有类的对象实例，以其接口的形式保存</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><h2 id=\"3-在服务管道中注册\"><a href=\"#3-在服务管道中注册\" class=\"headerlink\" title=\"3. 在服务管道中注册\"></a>3. 在服务管道中注册</h2><div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 以下是autofac依赖注入</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Host</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">UseServiceProviderFactory</span><span style=\"color: #89DDFF\">(new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">AutofacServiceProviderFactory</span><span style=\"color: #89DDFF\">());</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Host</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">ConfigureContainer</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">ContainerBuilder</span><span style=\"color: #89DDFF\">&gt;(</span><span style=\"color: #FFCB6B\">builder</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">    </span><span style=\"color: #676E95; font-style: italic\">//批量注册服务  注册模块</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RegisterModule</span><span style=\"color: #89DDFF\">(new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">CustomAutofacModule</span><span style=\"color: #89DDFF\">());</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;);</span></span></code></pre></div>","text":"1. 安装 AutoFac在项目中安装 Autofac.Extensions.DependencyInjection 包： bashdotnet add pac...","permalink":"/post/AutoFac配置教程","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":".NET8 Api框架搭建","slug":"NET8-Api框架搭建","count":5,"path":"api/categories/NET8-Api框架搭建.json"}],"tags":[{"name":".NET","slug":"NET","count":4,"path":"api/tags/NET.json"},{"name":"AutoFac","slug":"AutoFac","count":1,"path":"api/tags/AutoFac.json"},{"name":"依赖注入","slug":"依赖注入","count":1,"path":"api/tags/依赖注入.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-%E5%AE%89%E8%A3%85-AutoFac\"><span class=\"toc-text\">1. 安装 AutoFac</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-%E9%85%8D%E7%BD%AE%E7%B1%BB-CustomAutofacModule\"><span class=\"toc-text\">2. 配置类 CustomAutofacModule</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AE%A1%E9%81%93%E4%B8%AD%E6%B3%A8%E5%86%8C\"><span class=\"toc-text\">3. 在服务管道中注册</span></a></li></ol>","author":{"name":"小刘","slug":"blog-author","avatar":"/images/1.jpg","link":"/","description":"一位正在重塑知识的技术人。作为一名.net后端程序员，我专注于前端和后端技术的开发，热衷于探索新技术并分享我的学习与实践经验。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"通用Result","uid":"7bdb8fa9005fbdec4c435a665ce88cc2","slug":"通用Result","date":"2024-07-19T08:02:16.977Z","updated":"2024-07-19T08:07:01.956Z","comments":true,"path":"api/articles/通用Result.json","keywords":null,"cover":null,"text":"Result这个可以放在扩展文件夹里 csharpnamespace NET8Project.Api { public class ResultHandle {...","permalink":"/post/通用Result","photos":[],"count_time":{"symbolsCount":937,"symbolsTime":"1 mins."},"categories":[{"name":".NET8 Api框架搭建","slug":"NET8-Api框架搭建","count":5,"path":"api/categories/NET8-Api框架搭建.json"}],"tags":[{"name":".NET","slug":"NET","count":4,"path":"api/tags/NET.json"},{"name":"Result","slug":"Result","count":1,"path":"api/tags/Result.json"}],"author":{"name":"小刘","slug":"blog-author","avatar":"/images/1.jpg","link":"/","description":"一位正在重塑知识的技术人。作为一名.net后端程序员，我专注于前端和后端技术的开发，热衷于探索新技术并分享我的学习与实践经验。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}