{"title":"使用 JWTBearer 实现验证授权","uid":"f3b472985f94ae032ebf7e46f5293bd9","slug":"使用 JWTBearer 实现验证授权","date":"2024-07-19T08:11:35.000Z","updated":"2024-07-19T11:18:24.830Z","comments":true,"path":"api/articles/使用 JWTBearer 实现验证授权.json","keywords":null,"cover":"/images/2.png","content":"<h2 id=\"使用-JWTBearer-实现验证授权\"><a href=\"#使用-JWTBearer-实现验证授权\" class=\"headerlink\" title=\"使用 JWTBearer 实现验证授权\"></a>使用 JWTBearer 实现验证授权</h2><h3 id=\"1-NuGet-安装-Microsoft-AspNetCore-Authentication-JwtBearer\"><a href=\"#1-NuGet-安装-Microsoft-AspNetCore-Authentication-JwtBearer\" class=\"headerlink\" title=\"1. NuGet 安装 Microsoft.AspNetCore.Authentication.JwtBearer\"></a>1. NuGet 安装 Microsoft.AspNetCore.Authentication.JwtBearer</h3><p>注意版本兼容，使用 6.X 版本，7.x 版本不兼容 .NET Core 6。</p>\n<h3 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2. 配置文件\"></a>2. 配置文件</h3><div class=\"language-json\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">json</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">: </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">Issuer</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">gggk</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">// 发行人</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">Audience</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">audience</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">// 受众</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">SecurityKey</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">gggk20200202kggggggk20200202kggg</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">// 安全密钥</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">ExpireMinutes</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">60</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">// 过期时效（分钟）</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><h3 id=\"3-添加-Extensions-文件夹并在文件夹下添加类-AuthorizationSetup-cs\"><a href=\"#3-添加-Extensions-文件夹并在文件夹下添加类-AuthorizationSetup-cs\" class=\"headerlink\" title=\"3.添加 Extensions 文件夹并在文件夹下添加类 AuthorizationSetup.cs\"></a>3.添加 Extensions 文件夹并在文件夹下添加类 AuthorizationSetup.cs</h3><div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Extensions</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Configuration</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Extensions</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">DependencyInjection</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">IdentityModel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Tokens</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Collections</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Generic</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Linq</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Text</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Threading</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Tasks</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">namespace</span><span style=\"color: #BABED8\"> EFCoreProject</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Api</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">AuthorizationSetup</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">AddAuthorizationSetup</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">this</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">IServiceCollection</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">services</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FFCB6B\">IConfiguration</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">configuration</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">services </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">null)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">throw</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">ArgumentNullException</span><span style=\"color: #89DDFF\">(nameof(</span><span style=\"color: #BABED8\">services</span><span style=\"color: #89DDFF\">));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">// 配置策略授权</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            services</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddAuthorization</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">// 添加策略，使用时在方法上标注[Authorize(Policy =&quot;AdminPolicy&quot;)]，就会验证请求token中的ClaimTypes.Role是否包含了Admin</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddPolicy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">AdminPolicy</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//ClaimTypes.Role == Admin</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RequireRole</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Admin</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">Build</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//ClaimTypes.Role == Admin 或者 == User</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//o.RequireRole(&quot;Admin&quot;,&quot;User&quot;).Build(); </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//ClaimTypes.Role == Admin 并且 == User ,关于添加多个角色策略，在Login控制器中</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//o.RequireRole(&quot;Admin&quot;).RequireRole(&quot;User&quot;).Build(); </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//只有User的策略</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddPolicy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">onlyUserPolicy</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RequireRole</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">Build</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//User和Admin都可以访问的策略</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddPolicy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">UserOrAdminPolicy</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RequireRole</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Admin</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">Build</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//User并且是Admin才能请求的策略</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddPolicy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">UserAndAdminPolicy</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">RequireRole</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">RequireRole</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Admin</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">Build</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">key</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:SecurityKey</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">issuer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:Issuer</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">audience</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:Audience</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">SecurityKey</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">securityKey</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">SymmetricSecurityKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">Encoding</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">ASCII</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">GetBytes</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">key</span><span style=\"color: #89DDFF\">));</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//秘钥的长度有要求，必须&gt;=16位</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            services</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddAuthentication</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Bearer</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">AddJwtBearer</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                o</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">TokenValidationParameters </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">TokenValidationParameters</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//是否秘钥认证</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidateIssuerSigningKey </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FF9CAC\">true</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    IssuerSigningKey </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> securityKey</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//秘钥</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//是否验证发行人</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidateIssuer </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FF9CAC\">true</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidIssuer </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> issuer</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//这个字符串可以随便写，就是发行人</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//是否验证订阅</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidateAudience </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FF9CAC\">true</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidAudience </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> audience</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//是否验证过期时间</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    RequireExpirationTime </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FF9CAC\">true</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    ValidateLifetime </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FF9CAC\">true</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><h3 id=\"4-在-Program-类中添加以下代码\"><a href=\"#4-在-Program-类中添加以下代码\" class=\"headerlink\" title=\"4. 在 Program 类中添加以下代码\"></a>4. 在 Program 类中添加以下代码</h3><div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 注册 Jwt</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Services</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddAuthorizationSetup</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Configuration</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div><h3 id=\"5-在-Program-类中添加以下代码\"><a href=\"#5-在-Program-类中添加以下代码\" class=\"headerlink\" title=\"5. 在 Program 类中添加以下代码\"></a>5. 在 Program 类中添加以下代码</h3><div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 开启认证</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">UseAuthentication</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 在 app.UseAuthorization(); 之前</span></span></code></pre></div><h3 id=\"6-测试\"><a href=\"#6-测试\" class=\"headerlink\" title=\"6. 测试\"></a>6. 测试</h3><p>在控制器上添加 [Authorize] 特性类，所在命名空间 <code>using Microsoft.AspNetCore.Authorization</code>;</p>\n<h3 id=\"7-添加登录获取-token-的控制器\"><a href=\"#7-添加登录获取-token-的控制器\" class=\"headerlink\" title=\"7. 添加登录获取 token 的控制器\"></a>7. 添加登录获取 token 的控制器</h3><p>示例如下：</p>\n<div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">AspNetCore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Http</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">AspNetCore</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Mvc</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Extensions</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Configuration</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Microsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">IdentityModel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Tokens</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> Newtonsoft</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Json</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Collections</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Generic</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Dynamic</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">IdentityModel</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Tokens</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Jwt</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Linq</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Security</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Claims</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Text</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\"> System</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Threading</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Tasks</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">namespace</span><span style=\"color: #BABED8\"> EFCoreProject</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">API</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Controllers</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">Route</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">api/[controller]</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">ApiController</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">AuthenticationController</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">ControllerBase</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">private</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">readonly</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">IConfiguration</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">_configuration</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">AuthenticationController</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">IConfiguration</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">configuration</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #BABED8\">_configuration </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> configuration</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">HttpPost</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">dynamic</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Login</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #FFCB6B\">FromBody</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">LoginUser</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">user</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">dynamic</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">d</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">ExpandoObject</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">string</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">IsNullOrWhiteSpace</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">LoginName</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">||</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">IsNullOrWhiteSpace</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">LoginPwd</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">code </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">msg </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">账户密码不能为空！</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> d</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">LoginName </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">admin</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> user</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">LoginPwd</span><span style=\"color: #89DDFF\">==</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">123</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//验证通过</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//返回Token  （票）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">code </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">msg </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">登录成功！</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">token </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">GetJwtToken</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Roles</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> d</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">else</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">code </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">msg </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">账户或者密码错误！</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> d</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;</span><span style=\"color: #F07178; font-style: italic\">summary</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// 颁发令牌接口</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;/</span><span style=\"color: #F07178; font-style: italic\">summary</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">        </span><span style=\"color: #676E95; font-style: italic\">/// </span><span style=\"color: #89DDFF; font-style: italic\">&lt;</span><span style=\"color: #F07178; font-style: italic\">returns</span><span style=\"color: #89DDFF; font-style: italic\">&gt;&lt;/</span><span style=\"color: #F07178; font-style: italic\">returns</span><span style=\"color: #89DDFF; font-style: italic\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">HttpGet</span><span style=\"color: #89DDFF\">(nameof(</span><span style=\"color: #BABED8\">GetJwtToken</span><span style=\"color: #89DDFF\">))]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">GetJwtToken</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">userRole</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//获取在配置文件中获取Jwt属性设置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">key</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> _configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:SecurityKey</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//Appsettings.app(new string[] &#123; &quot;JwtSettings&quot;, &quot;SecurityKey&quot; &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">issuer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> _configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:Issuer</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//Appsettings.app(new string[] &#123; &quot;JwtSettings&quot;, &quot;Issuer&quot; &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">audience</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> _configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:Audience</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//Appsettings.app(new string[] &#123; &quot;JwtSettings&quot;, &quot;Audience&quot; &#125;);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">expireminutes</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> _configuration</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">JwtSettings:ExpireMinutes</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//创建授权的token类</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">SecurityToken</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">securityToken</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">JwtSecurityToken</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">issuer</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> issuer</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//签发人</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">audience</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> audience</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//受众</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">signingCredentials</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">SigningCredentials</span><span style=\"color: #89DDFF\">(new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">SymmetricSecurityKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">Encoding</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">ASCII</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">GetBytes</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">key</span><span style=\"color: #89DDFF\">)),</span><span style=\"color: #BABED8\"> SecurityAlgorithms</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">HmacSha256</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//秘钥</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//创建过期时间</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">expires</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> DateTime</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Now</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddMinutes</span><span style=\"color: #89DDFF\">(double.</span><span style=\"color: #82AAFF\">Parse</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">expireminutes</span><span style=\"color: #89DDFF\">)),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">//过期时间 </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                </span><span style=\"color: #676E95; font-style: italic\">//自定义JWT字段</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">claims</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Claim</span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//把模拟请求的角色权限添加到Role中 </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Claim</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">ClaimTypes</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Role</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">userRole</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//下面的都是自定义字段，可以任意添加到Claim作为信息共享</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//new Claim(&quot;Name&quot;,&quot;我叫lilili&quot;),</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">                    </span><span style=\"color: #676E95; font-style: italic\">//new Claim(&quot;Age&quot;,&quot;18&quot;),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//返回请求token</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">            </span><span style=\"color: #676E95; font-style: italic\">//return JsonConvert.SerializeObject(new &#123; token = new JwtSecurityTokenHandler().WriteToken(securityToken) &#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">JwtSecurityTokenHandler</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">WriteToken</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">securityToken</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">LoginUser</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">LoginName</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">get</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">set</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">public</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">LoginPwd</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">get</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">set</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><h3 id=\"8-前端调用\"><a href=\"#8-前端调用\" class=\"headerlink\" title=\"8. 前端调用\"></a>8. 前端调用</h3><p>请求时头部 Authorization: Bearer 空格Token<br>在 axios 请求拦截器中添加请求头：</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> (sessionStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getItem</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">token</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">null</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">config</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">headers</span><span style=\"color: #F07178\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Authorization</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">] </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Bearer </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">sessionStorage</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getItem</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">token</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"9-在Swagger中启动JWT认证\"><a href=\"#9-在Swagger中启动JWT认证\" class=\"headerlink\" title=\"9.在Swagger中启动JWT认证\"></a>9.在Swagger中启动JWT认证</h3><div class=\"language-csharp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">csharp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">builder</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Services</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddSwaggerGen</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">c</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    c</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddSecurityDefinition</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Bearer</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">OpenApiSecurityScheme</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        Description </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">请输入 token：Authorization:&#123;token&#125;</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        Name </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Authorization</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        In </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> ParameterLocation</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">Header</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        Type </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> SecuritySchemeType</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">ApiKey</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    c</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AddSecurityRequirement</span><span style=\"color: #89DDFF\">(new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">OpenApiSecurityRequirement</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">OpenApiSecurityScheme</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                Reference </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">OpenApiReference</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    Type </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> ReferenceType</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">SecurityScheme</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    Id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Bearer</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">string</span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;);</span></span></code></pre></div>","feature":true,"text":"使用 JWTBearer 实现验证授权1. NuGet 安装 Microsoft.AspNetCore.Authentication.JwtBearer注意版本...","permalink":"/post/使用 JWTBearer 实现验证授权","photos":[],"count_time":{"symbolsCount":"8.8k","symbolsTime":"8 mins."},"categories":[{"name":".NET8 Api框架搭建","slug":"NET8-Api框架搭建","count":5,"path":"api/categories/NET8-Api框架搭建.json"}],"tags":[{"name":"JWT","slug":"JWT","count":1,"path":"api/tags/JWT.json"},{"name":"Authorization","slug":"Authorization","count":1,"path":"api/tags/Authorization.json"},{"name":".NET Core","slug":"NET-Core","count":1,"path":"api/tags/NET-Core.json"},{"name":"ASP.NET","slug":"ASP-NET","count":1,"path":"api/tags/ASP-NET.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8-JWTBearer-%E5%AE%9E%E7%8E%B0%E9%AA%8C%E8%AF%81%E6%8E%88%E6%9D%83\"><span class=\"toc-text\">使用 JWTBearer 实现验证授权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-NuGet-%E5%AE%89%E8%A3%85-Microsoft-AspNetCore-Authentication-JwtBearer\"><span class=\"toc-text\">1. NuGet 安装 Microsoft.AspNetCore.Authentication.JwtBearer</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">2. 配置文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E6%B7%BB%E5%8A%A0-Extensions-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%B9%B6%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E6%B7%BB%E5%8A%A0%E7%B1%BB-AuthorizationSetup-cs\"><span class=\"toc-text\">3.添加 Extensions 文件夹并在文件夹下添加类 AuthorizationSetup.cs</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%9C%A8-Program-%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">4. 在 Program 类中添加以下代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E5%9C%A8-Program-%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">5. 在 Program 类中添加以下代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-%E6%B5%8B%E8%AF%95\"><span class=\"toc-text\">6. 测试</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#7-%E6%B7%BB%E5%8A%A0%E7%99%BB%E5%BD%95%E8%8E%B7%E5%8F%96-token-%E7%9A%84%E6%8E%A7%E5%88%B6%E5%99%A8\"><span class=\"toc-text\">7. 添加登录获取 token 的控制器</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#8-%E5%89%8D%E7%AB%AF%E8%B0%83%E7%94%A8\"><span class=\"toc-text\">8. 前端调用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-%E5%9C%A8Swagger%E4%B8%AD%E5%90%AF%E5%8A%A8JWT%E8%AE%A4%E8%AF%81\"><span class=\"toc-text\">9.在Swagger中启动JWT认证</span></a></li></ol></li></ol>","author":{"name":"小刘","slug":"blog-author","avatar":"/images/1.jpg","link":"/","description":"一位正在重塑知识的技术人。作为一名.net后端程序员，我专注于前端和后端技术的开发，热衷于探索新技术并分享我的学习与实践经验。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"AutoMapper配置教程","uid":"b84c84a24d4fbceb89d7a0429211000c","slug":"AutoFac配置教程 (2)","date":"2024-07-18T12:04:40.525Z","updated":"2024-07-19T08:08:46.419Z","comments":true,"path":"api/articles/AutoFac配置教程 (2).json","keywords":null,"cover":null,"text":"1.NuGet安装 在项目中安装 AutoMapper 包； 2.添加 AutoMapperConfigs 类到拓展文件夹csharpusing AutoMap...","permalink":"/post/AutoFac配置教程 (2)","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":".NET8 Api框架搭建","slug":"NET8-Api框架搭建","count":5,"path":"api/categories/NET8-Api框架搭建.json"}],"tags":[{"name":"AutoMapper","slug":"AutoMapper","count":1,"path":"api/tags/AutoMapper.json"},{"name":".NET","slug":"NET","count":4,"path":"api/tags/NET.json"},{"name":"映射","slug":"映射","count":1,"path":"api/tags/映射.json"}],"author":{"name":"小刘","slug":"blog-author","avatar":"/images/1.jpg","link":"/","description":"一位正在重塑知识的技术人。作为一名.net后端程序员，我专注于前端和后端技术的开发，热衷于探索新技术并分享我的学习与实践经验。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}